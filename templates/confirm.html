{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>抽出結果の確認</h2>
    <form method="POST" action="/save" onsubmit="showLoading()">
        <input type="hidden" name="file_path" value="{{ file_path }}">
        <input type="hidden" name="staff_name" value="{{ staff_name }}">

        <!-- Editable Fields -->
        {% if mode != 'qa' and data.get('取引先名') %}
        <div style="background:#f0f9ff; padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid #bae6fd;">
            <label style="color:#0369a1; font-size:0.8rem;">クライアント名</label>
            <div style="font-weight:bold; color:#0284c7;">{{ data['取引先名'] }}</div>
            <input type="hidden" name="取引先ID" value="{{ data.get('取引先ID', '') }}">
        </div>
        {% endif %}

        {% for key, value in data.items() %}
        {% if key != '取引先ID' and key != '取引先名' %}
        <label>{{ key }}</label>
        {% if key == "qa_list" %}
        <div style="background:#f9fafb; padding:15px; border-radius:8px; border:1px solid #e5e7eb;">
            {% for item in value %}
            <div style="margin-bottom:15px; border-bottom:1px dashed #ccc; padding-bottom:10px;">
                <div style="font-weight:bold; color:#0369a1; margin-bottom:5px;">Q. {{ item.question }}</div>
                <div style="line-height:1.6;">A. {{ item.answer }}</div>
            </div>
            {% endfor %}
        </div>
        <!-- Raw data hidden just in case -->
        <textarea name="{{ key }}" style="display:none;">{{ value | tojson }}</textarea>
        {% elif key in ["商談内容", "現在の課題・問題点", "競合・マーケット情報"] %}
        <textarea name="{{ key }}">{{ value }}</textarea>
        {% elif key == "新規営業件名" or key == "次回営業件名" %}
        <select name="{{ key }}">
            <option value="">(未選択)</option>
            {% for opt in sales_options %}
            <option value="{{ opt }}" {% if opt==value %}selected{% endif %}>{{ opt }}</option>
            {% endfor %}
        </select>
        {% else %}
        <input type="text" name="{{ key }}" value="{{ value }}">
        {% endif %}
        {% endif %}
        {% endfor %}

        <div style="margin-top: 20px;">
            {% if mode != 'qa' %}
            <button type="submit" class="btn-primary">Kintoneに登録</button>
            {% else %}
            <a href="/" class="btn-primary"
                style="display:inline-block; text-decoration:none; background:#888;">トップに戻る</a>
            {% endif %}
        </div>
    </form>
    <div style="text-align:center; margin-top:15px;">
        <a href="/" style="color:#888; text-decoration:none;">戻る（破棄）</a>
    </div>
</div>
{% endblock %}